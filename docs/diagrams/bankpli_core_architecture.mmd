%%{ init: { 'theme': 'base', 'themeVariables': { 'fontSize': '14px' } } }%%
flowchart TD
    classDef mainApp fill:#FF6B6B,stroke:#C0392B,color:#fff,stroke-width:2px
    classDef cicsOnline fill:#F7DC6F,stroke:#F39C12,color:#333,stroke-width:2px
    classDef batchProg fill:#96CEB4,stroke:#27AE60,color:#333,stroke-width:2px
    classDef copylib fill:#4ECDC4,stroke:#1ABC9C,color:#333,stroke-width:2px
    classDef dataStore fill:#45B7D1,stroke:#2980B9,color:#fff,stroke-width:2px
    classDef external fill:#BB8FCE,stroke:#8E44AD,color:#fff,stroke-width:2px
    classDef jclBuild fill:#E8E8E8,stroke:#7F8C8D,color:#333,stroke-width:2px
    classDef runtime fill:#85C1E9,stroke:#2471A3,color:#333,stroke-width:2px

    %% â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    %% TOP: External Entry Points
    %% â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    subgraph entry["ğŸ–¥ï¸  Entry Points"]
        direction LR
        TERMINAL["3270 Terminal<br/>(CICS User)"]
        JCLSUB["JCL Submission<br/>(Batch Scheduler)"]
        COBOL_CALLER["COBOL Program<br/>(Cross-Language)"]
    end

    %% â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    %% CICS Transaction Server
    %% â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    subgraph cics["ğŸ”·  CICS Transaction Server"]
        direction TB
        BNKMAIN["<b>BNKMAIN</b><br/>Main Dispatcher<br/>â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€<br/>CUST â”‚ ACCT â”‚ XFER<br/>MENU â”‚ BTCH"]

        subgraph online["Online Transaction Programs"]
            direction LR
            BNKCUST["<b>BNKCUST</b><br/>Customer Mgmt<br/>â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€<br/>CRUD + Cursor<br/>BMS Map I/O"]
            BNKACCT["<b>BNKACCT</b><br/>Account Mgmt<br/>â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€<br/>CONTROLLED/AREA<br/>Amortization"]
            BNKXFER["<b>BNKXFER</b><br/>Fund Transfer<br/>â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€<br/>2-Phase Commit<br/>Recursive Routing"]
            BNKCREDT["<b>BNKCREDT</b><br/>Credit Scoring<br/>â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€<br/>TASK/EVENT<br/>Parallel Bureaus"]
        end
    end

    %% â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    %% Batch Processing
    %% â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    subgraph batch["ğŸ“¦  Batch Processing"]
        direction LR
        BNKBATCH["<b>BNKBATCH</b><br/>Data Generator<br/>â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€<br/>VSAM + Sequential<br/>REGIONAL(1)"]
        BNKAUDIT["<b>BNKAUDIT</b><br/>Audit Logger<br/>â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€<br/>3 PRINT Files<br/>FILE Variable"]
        BNKARCH["<b>BNKARCH</b><br/>Archive/Compliance<br/>â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€<br/>REGIONAL(3)/DIRECT<br/>TRANSIENT/BACKWARDS"]
        BNKFX["<b>BNKFX</b><br/>FX/International<br/>â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€<br/>WIDECHAR/GRAPHIC<br/>SWIFT MT103"]
    end

    %% â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    %% Shared Package
    %% â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    subgraph foundation["ğŸ—ï¸  Foundation Package"]
        BNKPKG["<b>BNKPKG</b><br/>Root Package<br/>â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€<br/>DEFINE ALIAS/ORDINAL/STRUCTURE<br/>GENERICâ”‚CONDITIONâ”‚FORMAT"]
    end

    %% â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    %% Data Stores
    %% â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    subgraph datastores["ğŸ’¾  Persistent Data Stores"]
        direction LR
        DB2[("DB2 Subsystem<br/>â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€<br/>CUSTOMER_TABLE<br/>ACCOUNT_TABLE<br/>TRANSACTION_TABLE")]
        VSAM[("VSAM KSDS<br/>â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€<br/>CUSTOMER.MASTER<br/>ACCOUNT.MASTER")]
        SEQFILES[("Sequential &<br/>Regional Files<br/>â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€<br/>TRANSACTION.SEQ<br/>REGIONAL.DATA")]
        REPORTS[("Report Output<br/>â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€<br/>AUDIT.LOG<br/>DETAIL.REPORT<br/>SUMMARY.REPORT")]
    end

    %% â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    %% Build Infrastructure
    %% â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    subgraph build_infra["âš™ï¸  Build Infrastructure"]
        direction LR
        COMPILE_JCL["COMPILE.JCL<br/>32-Step Build<br/>â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€<br/>DB2 Precompile â†’<br/>CICS Translate â†’<br/>PL/I Compile â†’<br/>Link-Edit â†’ BIND"]
        RUN_JCL["RUNBATCH.JCL<br/>Execution<br/>â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€<br/>GENERATE â†’<br/>AUDIT â†’ SCORE â†’<br/>VERIFY"]
    end

    %% â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    %% CONNECTIONS: Entry â†’ Dispatcher
    %% â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    TERMINAL -->|"CUST/ACCT/XFER<br/>MENU/BTCH"| BNKMAIN
    COBOL_CALLER -->|"COBOL_ENTRY<br/>OPTIONS(COBOL)"| BNKMAIN
    JCLSUB -->|"BATCH_INIT<br/>Entry Point"| BNKMAIN
    JCLSUB -->|"Direct Exec"| BNKBATCH
    JCLSUB -->|"Direct Exec"| BNKAUDIT
    JCLSUB -->|"Direct Exec"| BNKARCH
    JCLSUB -->|"Direct Exec"| BNKFX

    %% CONNECTIONS: Dispatcher â†’ Online Programs
    BNKMAIN -->|"EXEC CICS LINK"| BNKCUST
    BNKMAIN -->|"EXEC CICS LINK"| BNKACCT
    BNKMAIN -->|"EXEC CICS LINK"| BNKXFER
    BNKMAIN -->|"EXEC CICS LINK"| BNKBATCH
    BNKCREDT -.->|"EXTERNAL counters<br/>TOTAL_REQUESTS"| BNKMAIN

    %% CONNECTIONS: Programs â†’ Data Stores
    BNKCUST -->|"SELECT/INSERT<br/>CURSOR"| DB2
    BNKXFER -->|"UPDATE + SAVEPOINT<br/>2-Phase Commit"| DB2
    BNKBATCH -->|"INSERT + COMMIT"| DB2
    BNKBATCH -->|"WRITE KEYFROM"| VSAM
    BNKBATCH -->|"WRITE"| SEQFILES
    BNKCREDT -.->|"READ (Batch)"| VSAM
    BNKAUDIT -->|"PUT EDIT/LIST"| REPORTS
    BNKARCH -->|"DIRECT/BACKWARDS<br/>LOCATE"| SEQFILES

    %% CONNECTIONS: Foundation
    BNKPKG -.->|"%INCLUDE"| BNKMAIN
    BNKPKG -.->|"%INCLUDE"| BNKCUST
    BNKPKG -.->|"%INCLUDE"| BNKACCT
    BNKPKG -.->|"%INCLUDE"| BNKXFER
    BNKPKG -.->|"%INCLUDE"| BNKBATCH
    BNKPKG -.->|"%INCLUDE"| BNKCREDT
    BNKPKG -.->|"%INCLUDE"| BNKAUDIT
    BNKPKG -.->|"%INCLUDE"| BNKARCH
    BNKPKG -.->|"%INCLUDE"| BNKFX

    %% Build
    COMPILE_JCL -.->|"Builds All"| foundation
    COMPILE_JCL -.->|"Builds All"| cics
    COMPILE_JCL -.->|"Builds All"| batch
    RUN_JCL -.->|"Executes"| batch

    %% â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    %% STYLES
    %% â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    class BNKMAIN mainApp
    class BNKCUST,BNKACCT,BNKXFER,BNKCREDT cicsOnline
    class BNKBATCH,BNKAUDIT,BNKARCH,BNKFX batchProg
    class BNKPKG copylib
    class DB2,VSAM,SEQFILES,REPORTS dataStore
    class TERMINAL,COBOL_CALLER,JCLSUB external
    class COMPILE_JCL,RUN_JCL jclBuild
